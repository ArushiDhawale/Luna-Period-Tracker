<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luna - Smart Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #faf5ff; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">

    <!-- <header class="bg-purple-500 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-24">
                <img src="logo.png" alt="Logo" class="h-8 w-auto">
                <img src="name.png" alt="Name" class="h-8 w-auto">
            </a>
            <nav class="hidden md:flex items-center space-x-6 text-purple-100 font-semibold">
                <a href="index.html" class="text-white border-b-2 border-white">Home</a>
                <a href="calendar.html" class="hover:text-white transition">Calendar</a>
                <a href="education.html" class="hover:text-white transition">Education</a>
                <a href="support.html" class="hover:text-white transition">Support</a>
                <a href="journal.html" class="hover:text-white transition">Journal</a>

                <div id="authSection" class="ml-4">
                    <a href="login.html" class="bg-white text-purple-600 px-4 py-2 rounded-full font-bold hover:bg-gray-100 transition shadow-sm text-sm">Login</a>
                </div>
            </nav>
        </div>
    </header> -->

    <div id="navbar-placeholder"></div>

    <main class="flex-grow container mx-auto px-4 py-8">
        <h2 class="text-3xl font-bold text-purple-800 mb-6 text-center">Monthly Overview</h2>
        ...
    </main>

    <script src="loadNavbar.js"></script> 
    
    <script type="module" src="calendar.js"></script>

    <main class="flex-grow container mx-auto px-4 py-8">
        
        <div id="welcomeMsg" class="w-full max-w-4xl mb-6 hidden mx-auto">
            <h2 class="text-2xl font-bold text-gray-700 text-center md:text-left">Hello, <span id="userNameDisplay" class="text-purple-600">User</span>! ðŸ‘‹</h2>
        </div>

        <div class="w-full max-w-2xl mx-auto bg-white rounded-3xl shadow-xl p-8 mb-10 border border-purple-100">
            <h2 class="text-2xl font-extrabold text-purple-800 mb-6 text-center">Health Diagnostic</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Last Period Start</label>
                    <input type="date" id="startDate" class="w-full p-3 border border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:outline-none bg-purple-50/50">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Avg Cycle Length (Days)</label>
                    <input type="number" id="avgLength" placeholder="e.g. 28" class="w-full p-3 border border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:outline-none bg-purple-50/50">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Typical Pain Intensity (1-10)</label>
                    <input type="range" id="painIntensity" min="1" max="10" class="w-full h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-purple-600">
                </div>
            </div>
            <button onclick="calculateCycle()" class="w-full mt-6 bg-gradient-to-r from-purple-500 to-fuchsia-500 text-white font-black py-4 rounded-2xl shadow-lg hover:from-purple-600 hover:to-fuchsia-600 transition transform hover:scale-[1.01]">
                GENERATE SMART INSIGHTS
            </button>
        </div>

        <div id="dashboard" class="w-full max-w-6xl mx-auto hidden space-y-8">
            
            <div class="bg-gradient-to-r from-purple-600 to-fuchsia-500 rounded-3xl p-8 text-white shadow-xl flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-center md:text-left">
                    <p class="text-purple-100 uppercase text-xs font-bold tracking-widest mb-1">Current Phase</p>
                    <h2 class="text-4xl font-black" id="phaseName">--</h2>
                    <p class="mt-2 text-purple-200">Estimated Next Period: <span id="nextDate" class="font-bold text-white">--</span></p>
                </div>
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/20 text-center">
                    <p class="text-xs font-bold uppercase text-purple-200">Stability Status</p>
                    <p id="statusBadge" class="text-xl font-bold mt-1">--</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <div class="lg:col-span-7 bg-white rounded-3xl p-6 shadow-xl border border-purple-50">
                    <h3 class="font-bold text-gray-700 mb-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-purple-400"></i> Regulatory Trends
                    </h3>
                    <div class="h-64">
                        <canvas id="regChart"></canvas>
                    </div>
                </div>

                <div class="lg:col-span-5 flex flex-col gap-4">
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-green-400">
                        <h4 class="font-bold text-green-600 uppercase text-xs tracking-widest">Energy Forecast</h4>
                        <p id="energyText" class="text-gray-600 text-sm mt-2 leading-relaxed">--</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-orange-400">
                        <h4 class="font-bold text-orange-600 uppercase text-xs tracking-widest">Pain Forecast</h4>
                        <p id="painText" class="text-gray-600 text-sm mt-2 leading-relaxed">--</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-blue-400">
                        <h4 class="font-bold text-blue-600 uppercase text-xs tracking-widest">Nutrition & Recovery</h4>
                        <p id="dietText" class="text-gray-600 text-sm mt-2 leading-relaxed">--</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let myChart;

        // === Auth Logic ===
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('luna_is_logged_in');
            const userName = localStorage.getItem('luna_user_name');
            if (isLoggedIn === 'true' && userName) {
                document.getElementById('userNameDisplay').innerText = userName;
                document.getElementById('welcomeMsg').classList.remove('hidden');
                document.getElementById('authSection').innerHTML = `<button onclick="logout()" class="text-purple-100 font-semibold text-sm">Logout <i class="fas fa-sign-out-alt ml-1"></i></button>`;
            }
        });

        function logout() {
            localStorage.clear();
            window.location.reload();
        }

        // === Smart Insights Logic ===
        function calculateCycle() {
            const startDateInput = document.getElementById('startDate').value;
            const avgLength = parseInt(document.getElementById('avgLength').value);
            const painLevel = document.getElementById('painIntensity').value;

            if(!startDateInput || !avgLength) return alert("Please fill in your date and average cycle length.");

            const lastStart = new Date(startDateInput);
            const today = new Date();
            const diffDays = Math.floor((today - lastStart) / (1000 * 60 * 60 * 24));
            const dayOfCycle = diffDays >= 0 ? (diffDays % avgLength) + 1 : 1;

            // Phase Logic
            let phase = "";
            let recommendations = {};
            if (dayOfCycle <= 5) {
                phase = "Menstrual";
                recommendations = { energy: "Low energy expected. Prioritize sleep.", pain: painLevel > 6 ? "High risk of cramps. Prep heating pads." : "Moderate discomfort likely.", diet: "Iron-rich foods & magnesium." };
            } else if (dayOfCycle <= 13) {
                phase = "Follicular";
                recommendations = { energy: "Rising power! Estrogen is increasing.", pain: "Low pain risk. Great for activity.", diet: "Fermented foods & lean proteins." };
            } else if (dayOfCycle === 14) {
                phase = "Ovulation";
                recommendations = { energy: "Peak vitality and social energy.", pain: "Minimal risk. You're at your strongest.", diet: "Antioxidants & berries." };
            } else {
                phase = "Luteal";
                recommendations = { energy: "Energy may dip. Progesterone rising.", pain: "Possible PMS symptoms starting.", diet: "Complex carbs (Sweet potatoes)." };
            }

            // Update UI
            document.getElementById('phaseName').innerText = phase;
            const nextPeriod = new Date(lastStart);
            nextPeriod.setDate(lastStart.getDate() + avgLength);
            document.getElementById('nextDate').innerText = nextPeriod.toDateString();
            
            document.getElementById('energyText').innerText = recommendations.energy;
            document.getElementById('painText').innerText = recommendations.pain;
            document.getElementById('dietText').innerText = recommendations.diet;

            // Status Logic
            const statusBadge = document.getElementById('statusBadge');
            if(avgLength > 35 || avgLength < 21) {
                statusBadge.innerText = "Irregular Pattern";
                statusBadge.className = "text-xl font-bold mt-1 text-orange-200";
            } else {
                statusBadge.innerText = "Regulatory Stable";
                statusBadge.className = "text-xl font-bold mt-1 text-green-200";
            }

            // Show Dashboard & Scroll
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });

            // Trigger Graph
            renderGraph(avgLength);
        }

        function renderGraph(avg) {
            const ctx = document.getElementById('regChart').getContext('2d');
            const history = [avg - 1, avg + 1, avg + 10, avg - 2, avg]; // Simulated spike at 3rd month

            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5'],
                    datasets: [{
                        data: history,
                        borderColor: '#a855f7',
                        borderWidth: 4,
                        tension: 0.4,
                        pointBackgroundColor: (c) => c.raw > 35 || c.raw < 21 ? '#fbbf24' : '#a855f7',
                        pointRadius: 6,
                        fill: true,
                        backgroundColor: 'rgba(168, 85, 247, 0.05)'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { suggestedMin: 20, suggestedMax: 50 } }
                }
            });
        }
    </script>
</body>
</html>
